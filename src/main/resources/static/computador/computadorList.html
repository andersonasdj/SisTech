<!DOCTYPE html>
<html lang="br">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" href="../assets/img/favicon.ico">
	<link rel="stylesheet" href="../assets/css/styleBusca.css">
	<link rel="stylesheet" href="../assets/css/StyleClientesFuncionarios.css">
	<link rel="stylesheet" href="../assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../assets/css/password-generator.css">
	<link rel="stylesheet" href="../assets/css/bootstrap-icons.min.css">
	<link rel="stylesheet" href="../assets/css/computadores.css">
	<link rel="stylesheet" href="../assets/css/dark.css">
	<title>Sistech - Computadores</title>
</head>
<body>
	<div class="container-fluid">
		<!-- ###################################### BARRA DE NAVEGAÇÃO ###################################### -->
		<nav class="navbar navbar-expand-lg bg-light">
			<div class="container-fluid">
				<a class="navbar-brand" href="/sistech/home"><img src="../assets/img/key.png" style="height: 18px;"> SisTech</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
					aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item"><a class="nav-link active" aria-current="page" href="/sistech/home">Início</a></li>
							<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Solicitações</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="/sistech/solicitacao/form">Novo</a></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/list">Listar</a></li>
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/modelos">Modelos</a></li>	
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/relatorios">Relatórios</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Clientes</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="/sistech/cliente/list">Listar</a></li>
								<li><a class="dropdown-item" href="/sistech/cliente/form">Novo</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Funcionarios</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="/sistech/funcionario/list">Listar</a></li>
								<li><a class="dropdown-item" href="/sistech/funcionario/form">Novo</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Dashboard</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="/dashboard/inicio" target="_blank" style="color: brown; font-weight: bold;">Realtime <i class="bi bi-speedometer2"></i></a></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/dashboard/geral">Solicitações ativas</a></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/dashboard/funcionario">Funcionario</a></li>
								<li><a class="dropdown-item" href="/sistech/solicitacao/dashboard/cliente">Cliente</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Ferramentas</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modalPasswordGenerator">Password Generator</a></li>
								<li><a class="dropdown-item" href="/sistech/avisos">Avisos</a></li>
								<li><a class="dropdown-item" href="/sistech/calendario">Calendário</a></li>
							</ul>
						</li>
					</ul>
					<span class="nav-item">
						  <button class="btn btn-sm btn-outline-secondary" onclick="toggleDarkMode()" id="toggleDarkBtn">
						    <i class="bi bi-moon"></i> Modo Escuro
						  </button>
						</span>
						&nbsp; &nbsp; &nbsp; &nbsp;
					<ul class="navbar-nav mb-3 mb-lg-0">
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" id="perfil" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"></a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="/sistech/funcionario/perfil">Perfil</a></li>
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="/sistech/gerencia">Gerência</a></li>
								<li><a class="dropdown-item" href="/sistech/configuracoes">Configurações</a></li><li>
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="/sistech/sobre">Sobre</a></li>
							</ul>
						</li>
							<a href="/sistech/logout"><i class="bi bi-power"style="font-size: 2rem; color: red;"></i></a>
					</ul>
				</div>
			</div>
		</nav>
		<!-- ###################################### BARRA DE NAVEGAÇÃO ###################################### -->

		<hr class="bg-danger border-2 border-top border-danger">
		
		<div class="container-fluid">
			
		  <div class="row">
		    <div class="col">
				<button class="btn btn-primary" onclick="alternarVisualizacao()" id="btnToggleView">
				  Visualizar como Cards
				</button>


		    </div>
		    <div class="col">
				<div class="form-group pull-right">
		    		<input id="boxBusca" type="text" class="search form-control" placeholder="Busca" autocomplete="off">
				</div>
				<span class="counter pull-right"> </span>
		    </div>
		  </div>
		</div>
		<div class="table-responsive">
			<div id="visualizacao-tabela" class="table-responsive">

				<table class="table table-striped align-middle results" id="tabela-computadores">
					<thead>
						<tr>
							<th scope="col">Status</th>
							<th scope="col">Cliente</th>
							<th scope="col">Domínio</th>
							<th scope="col">Hostname</th>
							<th scope="col">Usuário</th>
							<th scope="col">SO</th>
							<th scope="col">CPU</th>
							<th scope="col">Memória</th>
							<th scope="col">Fabricante</th>
							<th scope="col">Serial</th>
							<th scope="col">Ultima Autalização</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr> </tr>
					</tbody>
				</table>
			</div>
		</div>
		<div id="visualizacao-cards" class="row d-none"></div>
		<br /><br />
		<footer class="container-fluid fixed-bottom text-center text-white">
				<div class="text-center" style="background-color: rgba(0, 0, 0, 0.2);">
					© 2025 Copyright:
					<a class="text-white" href="#">TechGold</a>
				</div>
		</footer>
		
	<script src="../assets/js/jquery-3.6.3.js"></script>
	<script src="../assets/js/popper.min.js"></script>
	<script src="../assets/js/bootstrap.min.js"></script>
	<script src="../assets/js/dark.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
			tooltipTriggerList.forEach(function (el) {
				new bootstrap.Tooltip(el);
			});
		});
	</script>
	<script>
		function alternarVisualizacao() {
		  const tabela = document.getElementById('visualizacao-tabela');
		  const cards = document.getElementById('visualizacao-cards');
		  const botao = document.getElementById('btnToggleView');

		  if (tabela.classList.contains('d-none')) {
		    tabela.classList.remove('d-none');
		    cards.classList.add('d-none');
		    botao.innerText = 'Visualizar como Cards';
		  } else {
		    tabela.classList.add('d-none');
		    cards.classList.remove('d-none');
		    botao.innerText = 'Visualizar como Tabela';
		  }
		}

	</script>

	<script>
		$.ajax({
			type: "GET",
			contentType: "application/json",
			url: "/sistech/api/v1/computador",
			success: function (data) {
				data.forEach(i => {
					const dateString = i.last_seen;
					const [datePart, timePart] = dateString.split(' ');
					const [day, month, year] = datePart.split('/');
					const isoString = `${year}-${month}-${day}T${timePart}`;
					
					const lastSeenDate = new Date(isoString);
					const now = new Date();
					const diffMinutes = (now - lastSeenDate) / 1000 / 60;
					const isOnline = diffMinutes <= 4;
					const statusHTML = `<span class="status-indicator ${isOnline ? 'online' : 'offline'}" title="${isOnline ? 'Online' : 'Offline'}"></span>`;

				      // Tabela
				      var itens = `<tr id="linha${i.id}">
						<td>${statusHTML}</td>
				        <td title="${i.cliente}">${i.cliente}</td>
				        <td title="${i.domain}">${i.domain}</td>
				        <td title="${i.name}">${i.name}</td>
				        <td title="${i.username}">${i.username}</td>
				        <td title="${i.os}">${i.os}</td>
				        <td class="long-text" title="${i.cpu}">${i.cpu}</td>
				        <td title="${i.ram}">Instalada: ${i.ram}<p>Disponível: ${i.ramAvailable}</td>
						<td class="long-text" title="${i.manufacturer}">${i.manufacturer}</td>
						<td class="long-text" title="${i.serial}">${i.serial}</td>
				        <td title="${i.last_seen}">${i.last_seen}</td>
				        <td><button class="btn btn-sm btn-danger" onclick="excluir(${i.id})">Excluir</button></td>
				      </tr>`;
				      $('#tabela-computadores').append(itens);

				      // Card
				      var card = `
				        <div class="col-md-6 col-lg-4" id="card-${i.id}">
				          <div class="card card-computador">
				            <div class="card-body">
				              <h5 class="card-title"><td>${statusHTML}</td> ${i.cliente} - ${i.name}</h5>
				              <p><strong>Domínio:</strong> ${i.domain}</p>
				              <p><strong>Usuário:</strong> ${i.username}</p>
				              <p><strong>SO:</strong> ${i.os}</p>
				              <p><strong>CPU:</strong> ${i.cpu}</p>
				              <p><strong>RAM:</strong> ${i.ram} (Disponível: ${i.ramAvailable})</p>
				              <p><strong>Armazenamento:</strong> ${i.disk && i.disk.length ? i.disk.join(', ') : ''}</p>
				              <p><strong>Disponível:</strong>  ${i.diskAvailable && i.diskAvailable.length ? i.diskAvailable.join('<br>') : ''}</p>
				              <p><strong>Fabricante:</strong> ${i.manufacturer}</p>
				              <p><strong>Serial:</strong> ${i.serial}</p>
				              <p><strong>IP:</strong> ${i.ipAddresses && i.ipAddresses.length ? i.ipAddresses.join(', ') : ''}</p>
				              <p><strong>MAC:</strong> ${i.mac}</p>
				              <p><strong>Boot:</strong> ${i.last_boot_time}</p>
				              <p><strong>Última Atualização:</strong> ${i.last_seen}</p>
				              <button class="btn btn-sm btn-danger" onclick="excluir(${i.id})">Excluir</button>
				            </div>
				          </div>
				        </div>`;
				      $('#visualizacao-cards').append(card);
			  });
			},
			statusCode: {
			  	500: function() { alert('Erro! Contate o desenvolvedor!'); },
			    401: function() { alert('Realize login novamente!'); }
			}
		});
		
		function excluir(id) {
		    if (confirm("Tem certeza que deseja excluir o ID " + id + "?")) {
				$.ajax({
					type: "DELETE",
					contentType: "application/json",
					url: "/sistech/api/v1/computador/" + id,
					success: function () {
						document.getElementById("linha" + id)?.remove();
						document.getElementById("card-" + id)?.remove();
					},
					error: function (e) { alert("Não foi possível excluir"); }
				});
		    }
		  }
		
	</script>
	<script>
		$(document).ready(function() {
		  $(".search").keyup(function () {
		    var searchTerm = $(".search").val();
		    var listItem = $('.results tbody').children('tr');
		    var searchSplit = searchTerm.replace(/ /g, "'):containsi('")
		    
		  $.extend($.expr[':'], {'containsi': function(elem, i, match, array){
		  		return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
		    }
		  });
		    
		  $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e){
		    $(this).attr('visible','false');
		  });
		
		  $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e){
		    $(this).attr('visible','true');
		  });
		
		  var jobCount = $('.results tbody tr[visible="true"]').length;
		    $('.counter').text(jobCount + ' item');
		
		  if(jobCount == '0') {$('.no-result').show();}
		    else {$('.no-result').hide();}
				  });
		});
	</script>
</body>
</html>